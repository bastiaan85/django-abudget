{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load i18n %}
{% load humanize %}
{% load widget_tweaks %}

{% block title %}Transactions{% endblock %}

{% block content %}

    <div class='row'>
        <h1 class="page-header">Transactions</h1>
    
        <div class="col-lg-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <i class="fa fa-bell fa-fw"></i> Enter transaction
                </div>
                <!-- /.panel-heading -->
                    <div class="panel-body transaction-add-form">
                        <form action="{% url 'money:transaction_create' %}" method='post' class='form-horisontal'>
                            {% csrf_token %}
                            <input type='hidden' name='category' value='' id='id_selected_category' />

                            {{ new_transaction_form.errors }}

                            {% for toplevel_category in request.budget.get_toplevel_categories %}
                                <div class="btn-group" id='transaction_category_selector'>
                                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        {{ toplevel_category }} <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li class='category_item' data-category-id='{{ category.id }}'><a href="#">{{ toplevel_category }}</a></li>
                                        {% for category in toplevel_category.get_subcategories_recursive_list %}
                                            <li class='category_item' data-category-id='{{ category.id }}'><a>{{ category.get_title }}</a></li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            {% endfor %}

                            <p class="form-control-static" id="selected-category-field">...</p>

                            <input class="numberinput form-control col-lg-6" id="id_amount" name="amount" placeholder="Amount..." type="text">
                            {{ new_transaction_form.title|attr:"class:form-control"}}<br/>
                            <button class='btn btn-primary' type='submit'>Submit</button>
                        </form>
                    </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        </div>

        <div class='col-lg-6'>
            {% for trans in transactions %}
                <div class='transaction-item row'>
                    <i class='remove-transaction fa fa-times-circle' data-transaction-id='{{ trans.id }}'></i>
                    <span class='category col-lg-6'>{{ trans.category.get_title }}</span>
                    <span class='amount col-lg-3'>{{ trans.amount }}</span>
                    <span class='date col-lg-2'>{{ trans.date|naturalday }} {{ trans.date.time|time }}</span>
                    <span class='title col-lg-12'>{{ trans.title }}</span>
                </div>
            {% endfor %}
        </div>
    </div>
{% endblock %}